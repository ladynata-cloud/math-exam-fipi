<!doctype html>\n<html lang="ru">\n<head>\n  <meta charset="utf-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1" />\n  <title>ОГЭ №14 — прогрессии (пошаговый тренажёр)</title>\n  <style>\n    :root{\n      --bg:#0b1020;\n      --card:#ffffff;\n      --ink:#111827;\n      --muted:#6b7280;\n      --border:#e5e7eb;\n      --good:#047857;\n      --bad:#b91c1c;\n      --soft:#f8fafc;\n      --accent:#111827;\n      --accent2:#1f2937;\n      --focus:#2563eb;\n    }\n    *{box-sizing:border-box}\n    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#f3f4f6;color:var(--ink)}\n    header{\n      background:linear-gradient(180deg, #0b1020, #121a33);\n      color:#fff;\n      padding:22px 16px;\n    }\n    .wrap{max-width:1100px;margin:0 auto}\n    h1{margin:0;font-size:34px;letter-spacing:.2px}\n    .sub{margin-top:6px;color:#cbd5e1;font-size:14px}\n    .bar{\n      margin-top:16px;\n      display:flex;gap:10px;flex-wrap:wrap;align-items:end;\n    }\n    label{display:block;font-size:12px;letter-spacing:.08em;text-transform:uppercase;color:#cbd5e1;margin:0 0 6px}\n    select, input[type="text"], input[type="number"]{\n      height:46px; padding:10px 12px; border-radius:14px;\n      border:1px solid rgba(255,255,255,.18);\n      background:rgba(255,255,255,.06); color:#fff; outline:none;\n      font-size:16px; min-width: 220px;\n    }\n    select:focus, input:focus{ box-shadow: 0 0 0 3px rgba(37,99,235,.35); border-color: rgba(37,99,235,.8); }\n    button{\n      height:46px; padding:0 14px; border-radius:14px;\n      border:1px solid rgba(255,255,255,.18);\n      background:rgba(255,255,255,.06); color:#fff;\n      font-size:16px; cursor:pointer;\n    }\n    button.primary{ background:#fff; color:#0b1020; border-color:#fff; font-weight:800; }\n    button.ghost{ background:transparent; }\n    button:disabled{opacity:.6; cursor:not-allowed}\n    main{padding:18px 16px 28px}\n    .card{\n      background:var(--card);\n      border:1px solid var(--border);\n      border-radius:22px;\n      padding:18px;\n      max-width:1100px;\n      margin:0 auto;\n    }\n    .chips{display:flex;gap:10px;flex-wrap:wrap;align-items:center}\n    .chip{\n      display:inline-flex;align-items:center;gap:8px;\n      padding:7px 10px;border:1px solid var(--border);\n      border-radius:999px;background:#f9fafb;color:#374151;\n      font-size:13px;\n    }\n    .taskText{\n      margin-top:14px;\n      font-size:26px;\n      line-height:1.25;\n      white-space:pre-line;\n    }\n    .taskImg{\n      margin-top:14px;\n      max-width:100%;\n      border-radius:16px;\n      border:1px solid var(--border);\n      display:block;\n    }\n    .section{\n      margin-top:16px;\n      border-top:1px solid var(--border);\n      padding-top:16px;\n    }\n    .modeRow{\n      display:flex;gap:10px;flex-wrap:wrap;align-items:center\n    }\n    .modeBtn{\n      height:40px;border-radius:999px;padding:0 14px;\n      border:1px solid var(--border);background:#fff;color:#111;\n      font-weight:700;font-size:14px;\n    }\n    .modeBtn.active{\n      background:#111827;color:#fff;border-color:#111827;\n    }\n\n    .numPad{\n      margin-top:12px;\n      display:flex; gap:10px; flex-wrap:wrap;\n      padding:12px;\n      border:1px dashed var(--border);\n      border-radius:18px;\n      background:#fbfdff;\n    }\n    .numPadTitle{width:100%; font-weight:900; color:#111827}\n    .numChip{\n      border:1px solid var(--border);\n      background:#fff;\n      border-radius:999px;\n      padding:8px 12px;\n      cursor:pointer;\n      font-size:14px;\n    }\n    .numChip:active{transform:translateY(1px)}\n    .hintSmall{font-size:13px;color:var(--muted);margin-top:6px}\n\n    .stepper{\n      margin-top:14px;\n      border:1px solid var(--border);\n      border-radius:18px;\n      overflow:hidden;\n    }\n    .stepHead{\n      padding:12px 14px;\n      background:#f9fafb;\n      display:flex; gap:10px; flex-wrap:wrap; align-items:center;\n      border-bottom:1px solid var(--border);\n    }\n    .stepTitle{font-weight:900}\n    .progress{\n      margin-left:auto;\n      font-size:13px;\n      color:#374151;\n      padding:6px 10px;\n      background:#fff;\n      border:1px solid var(--border);\n      border-radius:999px;\n    }\n    .stepBody{padding:14px}\n    .q{\n      margin:0 0 10px;\n      font-size:18px;\n      font-weight:900;\n    }\n    .qSub{margin:-6px 0 12px; color:var(--muted); font-size:14px}\n    .grid{\n      display:grid;\n      grid-template-columns: repeat(2, minmax(240px, 1fr));\n      gap:12px;\n    }\n    .field{\n      border:1px solid var(--border);\n      border-radius:18px;\n      padding:12px;\n      background:#fff;\n    }\n    .field label{\n      color:#374151;\n      text-transform:none;\n      letter-spacing:0;\n      font-size:13px;\n      margin:0 0 8px;\n    }\n    .field input, .field select{\n      width:100%;\n      height:44px;\n      border-radius:14px;\n      border:1px solid var(--border);\n      background:#fff;\n      color:#111;\n    }\n    .field input:focus, .field select:focus{\n      outline:none;\n      box-shadow:0 0 0 3px rgba(37,99,235,.22);\n      border-color: rgba(37,99,235,.7);\n    }\n    .actions{\n      margin-top:12px;\n      display:flex; gap:10px; flex-wrap:wrap;\n    }\n    .btn{\n      height:44px;border-radius:14px;padding:0 14px;\n      border:1px solid var(--border); background:#fff; cursor:pointer;\n      font-size:16px;\n    }\n    .btn.primary{background:#111827;color:#fff;border-color:#111827;font-weight:900}\n    .btn.good{background:#ecfdf5;border-color:#a7f3d0;color:#065f46;font-weight:900}\n    .btn.bad{background:#fef2f2;border-color:#fecaca;color:#991b1b;font-weight:900}\n    .msg{margin-top:10px;font-size:15px}\n    .msg.ok{color:var(--good);font-weight:900}\n    .msg.bad{color:var(--bad);font-weight:900}\n\n    .miniCheck{\n      margin-top:12px;\n      display:grid;\n      grid-template-columns: 1fr;\n      gap:10px;\n    }\n    .miniRow{\n      border:1px solid var(--border);\n      border-radius:18px;\n      padding:12px;\n      background:var(--soft);\n      display:flex; gap:10px; flex-wrap:wrap; align-items:center;\n    }\n    .miniRow b{min-width:220px}\n    .miniRow input{height:42px; border-radius:14px; border:1px solid var(--border); padding:8px 10px; min-width:220px}\n    .miniRow button{height:42px}\n\n    table{\n      width:100%;\n      border-collapse:collapse;\n      margin-top:12px;\n      font-size:14px;\n    }\n    th,td{border-bottom:1px solid var(--border); padding:8px 6px; text-align:left}\n    th{color:#374151}\n    .right{ text-align:right }\n    .answerBox{\n      margin-top:14px;\n      padding:14px;\n      border:1px solid var(--border);\n      border-radius:18px;\n      background:#fff;\n    }\n    .answerRow{\n      display:flex; gap:10px; flex-wrap:wrap; align-items:center;\n    }\n    .answerRow input{\n      height:46px;\n      border-radius:14px;\n      border:1px solid var(--border);\n      padding:10px 12px;\n      font-size:16px;\n      min-width:260px;\n      flex:1;\n    }\n    .footerNote{ margin-top:10px; color:var(--muted); font-size:13px }\n    @media (max-width: 720px){\n      .grid{grid-template-columns: 1fr;}\n      .taskText{font-size:22px}\n    }\n  </style>\n</head>\n<body>\n<header>\n  <div class="wrap">\n    <h1>ОГЭ №14 — прогрессии</h1>\n    <div class="sub">Пошаговый тренажёр: ученик решает маленькими шагами, с полями и проверкой каждого шага.</div>\n\n    <div class="bar">\n      <div>\n        <label>ТЕМА</label>\n        <select id="topicSelect"></select>\n      </div>\n\n      <div>\n        <label>РЕЖИМ</label>\n        <select id="uiMode">\n          <option value="steps" selected>Пошагово (учусь)</option>\n          <option value="quick">Быстро (только ответ)</option>\n        </select>\n      </div>\n\n      <div style="flex:1"></div>\n\n      <button id="resetBtn" class="ghost">Сброс</button>\n      <button id="newBtn" class="primary">Новая задача</button>\n    </div>\n  </div>\n</header>\n\n<main>\n  <div class="card">\n    <div class="chips" id="chips"></div>\n\n    <div class="taskText" id="taskText">Загружаю базу…</div>\n    <img id="taskImg" class="taskImg" alt="Рисунок к задаче" style="display:none;" />\n\n    <div class="numPad" id="numPad" style="display:none;">\n      <div class="numPadTitle">Числа из условия (можно нажимать — вставится в поле)</div>\n      <div class="hintSmall">Совет: сначала щёлкните в поле, потом нажмите число.</div>\n      <div id="numPadBtns"></div>\n    </div>\n\n    <div class="section">\n      <div class="modeRow">\n        <button class="modeBtn active" id="modeStepsBtn">Пошагово</button>\n        <button class="modeBtn" id="modeQuickBtn">Быстро</button>\n        <span class="hintSmall" id="modeHint">Пошагово: ученик отвечает на маленькие вопросы и считает по шагам.</span>\n      </div>\n\n      <!-- ПОШАГОВЫЙ РЕЖИМ -->\n      <div id="stepsUI">\n        <div class="stepper">\n          <div class="stepHead">\n            <div class="stepTitle" id="stepTitle">Шаг 1</div>\n            <div class="progress" id="progress">1/5</div>\n          </div>\n          <div class="stepBody" id="stepBody"></div>\n        </div>\n      </div>\n\n      <!-- БЫСТРЫЙ РЕЖИМ -->\n      <div id="quickUI" style="display:none;">\n        <div class="answerBox">\n          <div class="q">Введи ответ</div>\n          <div class="answerRow">\n            <input id="quickAnswer" type="text" placeholder="Ответ" />\n            <button class="btn primary" id="quickCheckBtn">Проверить</button>\n          </div>\n          <div class="msg" id="quickMsg"></div>\n          <div class="footerNote" id="quickCorrect"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n</main>\n\n<script>\n(() => {\n  const DATA_URL = "../data/task14-progressions-2022-2025.json";\n\n  // На всякий случай — если в JSON нет image, покажем по id:\n  const IMAGE_BY_ID = {\n    7: "../assets/task14/snake.jpeg",\n    8: "../assets/task14/snake.jpeg",\n    9: "../assets/task14/tables.jpeg",\n    10:"../assets/task14/tables.jpeg",\n    25:"../assets/task14/logs.jpeg",\n    26:"../assets/task14/logs.jpeg",\n  };\n\n  const $ = (id) => document.getElementById(id);\n\n  const ui = {\n    topicSelect: $("topicSelect"),\n    uiMode: $("uiMode"),\n    newBtn: $("newBtn"),\n    resetBtn: $("resetBtn"),\n    chips: $("chips"),\n    taskText: $("taskText"),\n    taskImg: $("taskImg"),\n    numPad: $("numPad"),\n    numPadBtns: $("numPadBtns"),\n    stepsUI: $("stepsUI"),\n    quickUI: $("quickUI"),\n    modeStepsBtn: $("modeStepsBtn"),\n    modeQuickBtn: $("modeQuickBtn"),\n    modeHint: $("modeHint"),\n    stepTitle: $("stepTitle"),\n    progress: $("progress"),\n    stepBody: $("stepBody"),\n    quickAnswer: $("quickAnswer"),\n    quickCheckBtn: $("quickCheckBtn"),\n    quickMsg: $("quickMsg"),\n    quickCorrect: $("quickCorrect"),\n  };\n\n  let TASKS = [];\n  let currentTask = null;\n  let activeInput = null;\n\n  // состояние “пошагового” решения\n  const W = {\n    stepIndex: 0,\n    goal: "value",        // value | sum | steps\n    op: "add",            // add | mul\n    x0: null, y0: null,\n    dx: 1,\n    addDir: "down",       // up | down (при увеличении x)\n    dy: null,\n    mulOp: "div",         // mul | div (при увеличении x)\n    q: null,\n    x1: null,\n    n: null,\n    limitCmp: "<=",\n    limit: null,\n\n    // микро-проверки (шаг 4)\n    m1_ok:false, m2_ok:false, m3_ok:false, m4_ok:false,\n    seq: [],\n    computed: {\n      dxTotal: null,\n      steps: null,\n      sign: 1,\n      yFinal: null,\n      sum: null\n    }\n  };\n\n  function resetWorkState() {\n    W.stepIndex = 0;\n    W.goal = guessGoal(currentTask);\n    W.op = guessOp(currentTask);\n\n    W.x0 = null; W.y0 = null;\n    W.dx = 1;\n\n    W.addDir = "down";\n    W.dy = null;\n\n    W.mulOp = "div";\n    W.q = null;\n\n    W.x1 = null;\n    W.n = null;\n    W.limitCmp = "<=";\n    W.limit = null;\n\n    W.m1_ok = W.m2_ok = W.m3_ok = W.m4_ok = false;\n    W.seq = [];\n    W.computed = { dxTotal:null, steps:null, sign:1, yFinal:null, sum:null };\n  }\n\n  function normNumStr(s){\n    return String(s ?? "").trim().replace(",", ".").replace(/\s+/g,"");\n  }\n  function toNum(s){\n    const n = Number(normNumStr(s));\n    return Number.isFinite(n) ? n : null;\n  }\n  function approxEq(a,b){\n    return a !== null && b !== null && Math.abs(a-b) < 1e-9;\n  }\n\n  function getId(t){\n    const v = t?.id ?? t?.ID ?? t?.num ?? t?.number ?? null;\n    return v === null ? null : Number(v);\n  }\n  function getText(t){\n    return String(t?.text ?? t?.problem ?? t?.question ?? t?.prompt ?? "");\n  }\n  function getTopic(t){\n    return String(t?.topic ?? "");\n  }\n  function getSubtype(t){\n    return String(t?.subtype ?? "");\n  }\n  function getCanonicalAnswer(t){\n    const a = t?.answer;\n    if (a === null || a === undefined) return null;\n    if (typeof a === "string" || typeof a === "number") return String(a);\n    if (a.canonical !== undefined && a.canonical !== null) return String(a.canonical);\n    if (a.correct !== undefined && a.correct !== null) return String(a.correct);\n    return null;\n  }\n  function getAltAnswers(t){\n    const a = t?.answer;\n    if (!a || typeof a !== "object") return [];\n    return Array.isArray(a.alternatives) ? a.alternatives.map(String) : [];\n  }\n  function getImage(t){\n    const img = t?.image ?? null;\n    if (img) {\n      // если в JSON путь относительный от корня — поднимемся на уровень выше (мы в /trainers/)\n      if (img.startsWith("http")) return img;\n      if (img.startsWith("/")) return img;\n      return "../" + img.replace(/^\.?\//,"");\n    }\n    const id = getId(t);\n    return id && IMAGE_BY_ID[id] ? IMAGE_BY_ID[id] : null;\n  }\n\n  function guessOp(task){\n    const topic = (getTopic(task) + " " + getSubtype(task)).toLowerCase();\n    if (topic.includes("геометр")) return "mul";\n    // по умолчанию — “на сколько-то больше/меньше”\n    return "add";\n  }\n\n  function guessGoal(task){\n    const s = (getText(task) + " " + getSubtype(task)).toLowerCase();\n    if (s.includes("сколько всего") || s.includes("за первые") || s.includes("сумм")) return "sum";\n    if (s.includes("через сколько") || s.includes("сколько дней") && (s.includes("пока") || s.includes("когда") || s.includes("не станет"))) return "steps";\n    return "value";\n  }\n\n  function setUIMode(mode){\n    ui.uiMode.value = mode;\n    const steps = (mode === "steps");\n    ui.stepsUI.style.display = steps ? "" : "none";\n    ui.quickUI.style.display = steps ? "none" : "";\n    ui.modeStepsBtn.classList.toggle("active", steps);\n    ui.modeQuickBtn.classList.toggle("active", !steps);\n    ui.modeHint.textContent = steps\n      ? "Пошагово: ученик отвечает на маленькие вопросы и считает по шагам."\n      : "Быстро: просто введи ответ и проверь.";\n  }\n\n  function renderChips(task){\n    const id = getId(task);\n    const topic = getTopic(task);\n    const subtype = getSubtype(task);\n    ui.chips.innerHTML = "";\n    const mk = (txt) => {\n      const s = document.createElement("span");\n      s.className = "chip";\n      s.textContent = txt;\n      return s;\n    };\n    if (id) ui.chips.appendChild(mk("№ " + id));\n    if (topic) ui.chips.appendChild(mk(topic));\n    if (subtype) ui.chips.appendChild(mk(subtype));\n  }\n\n  function renderProblem(task){\n    ui.taskText.textContent = getText(task);\n    renderChips(task);\n\n    const img = getImage(task);\n    if (img) {\n      ui.taskImg.style.display = "";\n      ui.taskImg.src = img;\n    } else {\n      ui.taskImg.style.display = "none";\n      ui.taskImg.removeAttribute("src");\n    }\n\n    // Числа из условия\n    const nums = Array.from(new Set((getText(task).match(/\d+(?:[.,]\d+)?/g) || [])));\n    if (nums.length) {\n      ui.numPad.style.display = "";\n      ui.numPadBtns.innerHTML = "";\n      for (const n of nums) {\n        const b = document.createElement("button");\n        b.className = "numChip";\n        b.type = "button";\n        b.textContent = n;\n        b.addEventListener("click", () => {\n          if (!activeInput) return;\n          const el = activeInput;\n          el.value = n;\n          el.dispatchEvent(new Event("input"));\n          el.focus();\n        });\n        ui.numPadBtns.appendChild(b);\n      }\n    } else {\n      ui.numPad.style.display = "none";\n    }\n  }\n\n  function pickRandom(list){\n    if (!list.length) return null;\n    const i = Math.floor(Math.random() * list.length);\n    return list[i];\n  }\n\n  function filteredTasks(){\n    const v = ui.topicSelect.value;\n    if (v === "all") return TASKS;\n    return TASKS.filter(t => getTopic(t) === v);\n  }\n\n  function newTask(){\n    const pool = filteredTasks();\n    const next = pickRandom(pool);\n    if (!next) return;\n    currentTask = next;\n    renderProblem(currentTask);\n    resetWorkState();\n    ui.quickMsg.textContent = "";\n    ui.quickCorrect.textContent = "";\n    ui.quickAnswer.value = "";\n    showStep(0);\n  }\n\n  // ---------------------------\n  // ПОШАГОВЫЙ: шаги\n  // ---------------------------\n  function showStep(idx){\n    W.stepIndex = idx;\n    ui.progress.textContent = (idx+1) + "/5";\n    const titles = [\n      "Шаг 1 — Что нужно найти",\n      "Шаг 2 — Где известно значение",\n      "Шаг 3 — Как меняется каждый шаг",\n      "Шаг 4 — Посчитай по шагам",\n      "Шаг 5 — Введи ответ и проверь"\n    ];\n    ui.stepTitle.textContent = titles[idx] || ("Шаг " + (idx+1));\n    ui.stepBody.innerHTML = "";\n    if (idx === 0) renderStep1();\n    if (idx === 1) renderStep2();\n    if (idx === 2) renderStep3();\n    if (idx === 3) renderStep4();\n    if (idx === 4) renderStep5();\n  }\n\n  function navButtons(canBack, canNext, onBack, onNext){\n    const wrap = document.createElement("div");\n    wrap.className = "actions";\n\n    const b1 = document.createElement("button");\n    b1.className = "btn";\n    b1.textContent = "Назад";\n    b1.disabled = !canBack;\n    b1.addEventListener("click", onBack);\n\n    const b2 = document.createElement("button");\n    b2.className = "btn primary";\n    b2.textContent = "Дальше";\n    b2.disabled = !canNext;\n    b2.addEventListener("click", onNext);\n\n    wrap.appendChild(b1);\n    wrap.appendChild(b2);\n    return wrap;\n  }\n\n  function bindActive(el){\n    el.addEventListener("focus", () => activeInput = el);\n    el.addEventListener("click", () => activeInput = el);\n  }\n\n  function renderStep1(){\n    const h = document.createElement("div");\n    h.innerHTML = `\n      <div class="q">Выбираем, что нужно найти</div>\n      <div class="qSub">Если ты не уверен — выбери “найти значение”, это чаще всего.</div>\n    `;\n    ui.stepBody.appendChild(h);\n\n    const grid = document.createElement("div");\n    grid.className = "grid";\n\n    const f1 = document.createElement("div");\n    f1.className = "field";\n    f1.innerHTML = `\n      <label>Что ищем?</label>\n      <select id="goalSel">\n        <option value="value">Найти значение в другом месте (высота/ряд/день/время)</option>\n        <option value="sum">Найти сумму (сколько всего за несколько шагов)</option>\n        <option value="steps">Найти сколько шагов до условия (пока не станет…)</option>\n      </select>\n    `;\n    const goalSel = f1.querySelector("#goalSel");\n    goalSel.value = W.goal;\n    goalSel.addEventListener("change", () => W.goal = goalSel.value);\n\n    const f2 = document.createElement("div");\n    f2.className = "field";\n    f2.innerHTML = `\n      <label>Как меняется?</label>\n      <select id="opSel">\n        <option value="add">Прибавляем / убавляем (на сколько-то)</option>\n        <option value="mul">Умножаем / делим (в несколько раз)</option>\n      </select>\n      <div class="hintSmall">Обычно это уже видно по теме. Но если сомневаешься — можно переключить.</div>\n    `;\n    const opSel = f2.querySelector("#opSel");\n    opSel.value = W.op;\n    opSel.addEventListener("change", () => W.op = opSel.value);\n\n    grid.appendChild(f1);\n    grid.appendChild(f2);\n    ui.stepBody.appendChild(grid);\n\n    ui.stepBody.appendChild(\n      navButtons(false, true, () => {}, () => showStep(1))\n    );\n  }\n\n  function renderStep2(){\n    const h = document.createElement("div");\n    h.innerHTML = `\n      <div class="q">Запиши известную точку</div>\n      <div class="qSub">Где (x) и какое значение (y) там известно. Можно нажимать числа из условия.</div>\n    `;\n    ui.stepBody.appendChild(h);\n\n    const grid = document.createElement("div");\n    grid.className = "grid";\n\n    const f1 = document.createElement("div");\n    f1.className = "field";\n    f1.innerHTML = `<label>Где известно? (x₀)</label><input id="x0" type="text" placeholder="например: 2205 или 1" />`;\n    const x0 = f1.querySelector("#x0");\n    if (W.x0 !== null) x0.value = W.x0;\n    bindActive(x0);\n    x0.addEventListener("input", () => W.x0 = toNum(x0.value));\n\n    const f2 = document.createElement("div");\n    f2.className = "field";\n    f2.innerHTML = `<label>Значение там (y₀)</label><input id="y0" type="text" placeholder="например: 550" />`;\n    const y0 = f2.querySelector("#y0");\n    if (W.y0 !== null) y0.value = W.y0;\n    bindActive(y0);\n    y0.addEventListener("input", () => W.y0 = toNum(y0.value));\n\n    grid.appendChild(f1);\n    grid.appendChild(f2);\n    ui.stepBody.appendChild(grid);\n\n    const ok = (W.x0 !== null && W.y0 !== null);\n\n    ui.stepBody.appendChild(\n      navButtons(true, ok, () => showStep(0), () => showStep(2))\n    );\n  }\n\n  function renderStep3(){\n    const h = document.createElement("div");\n    h.innerHTML = `\n      <div class="q">Запиши правило одного шага</div>\n      <div class="qSub">Смысл: “на каждые Δx значение меняется вот так”.</div>\n    `;\n    ui.stepBody.appendChild(h);\n\n    const grid = document.createElement("div");\n    grid.className = "grid";\n\n    const fDX = document.createElement("div");\n    fDX.className = "field";\n    fDX.innerHTML = `<label>Размер шага по x (Δx)</label><input id="dx" type="text" placeholder="обычно 1 (ряд/день), или 10,5, или 7..." />`;\n    const dx = fDX.querySelector("#dx");\n    dx.value = String(W.dx ?? 1);\n    bindActive(dx);\n    dx.addEventListener("input", () => {\n      const v = toNum(dx.value);\n      W.dx = (v === null || v === 0) ? 1 : v;\n    });\n\n    const fRule = document.createElement("div");\n    fRule.className = "field";\n\n    if (W.op === "add") {\n      fRule.innerHTML = `\n        <label>Когда x увеличивается на Δx, y…</label>\n        <select id="addDir">\n          <option value="up">увеличивается</option>\n          <option value="down">уменьшается</option>\n        </select>\n        <div style="height:10px"></div>\n        <label>…на сколько? (Δy)</label>\n        <input id="dy" type="text" placeholder="например: 1 или 2,5" />\n      `;\n      const addDir = fRule.querySelector("#addDir");\n      const dy = fRule.querySelector("#dy");\n      addDir.value = W.addDir;\n      addDir.addEventListener("change", () => W.addDir = addDir.value);\n      if (W.dy !== null) dy.value = W.dy;\n      bindActive(dy);\n      dy.addEventListener("input", () => W.dy = toNum(dy.value));\n    } else {\n      fRule.innerHTML = `\n        <label>Когда x увеличивается на Δx, y…</label>\n        <select id="mulOp">\n          <option value="mul">умножается</option>\n          <option value="div">делится</option>\n        </select>\n        <div style="height:10px"></div>\n        <label>…на сколько раз? (q)</label>\n        <input id="q" type="text" placeholder="например: 2 или 3" />\n      `;\n      const mulOp = fRule.querySelector("#mulOp");\n      const q = fRule.querySelector("#q");\n      mulOp.value = W.mulOp;\n      mulOp.addEventListener("change", () => W.mulOp = mulOp.value);\n      if (W.q !== null) q.value = W.q;\n      bindActive(q);\n      q.addEventListener("input", () => W.q = toNum(q.value));\n    }\n\n    grid.appendChild(fDX);\n    grid.appendChild(fRule);\n    ui.stepBody.appendChild(grid);\n\n    const ok = (W.dx !== null && W.dx !== 0) && ((W.op === "add" && W.dy !== null) || (W.op === "mul" && W.q !== null && W.q !== 0));\n\n    ui.stepBody.appendChild(\n      navButtons(true, ok, () => showStep(1), () => showStep(3))\n    );\n  }\n\n  function computeStepSign(fromX, toX){\n    const dxTotal = toX - fromX;\n    const steps = dxTotal / W.dx;\n    if (!Number.isFinite(steps)) return null;\n    const sign = steps >= 0 ? 1 : -1;\n    return { dxTotal, steps, sign };\n  }\n\n  function forwardFactor(){\n    // фактор для шага вперёд (x увеличился на Δx)\n    if (W.op === "add") return null;\n    const q = W.q;\n    if (!q || q === 0) return null;\n    return (W.mulOp === "mul") ? q : (1 / q);\n  }\n\n  function forwardDeltaY(){\n    if (W.op !== "add") return null;\n    const dy = W.dy;\n    if (dy === null) return null;\n    return (W.addDir === "up") ? dy : -dy;\n  }\n\n  function buildSequenceValue(toX){\n    // строим ряд от x0,y0 до нужного x (включительно)\n    const base = computeStepSign(W.x0, toX);\n    if (!base) return null;\n\n    const stepsRaw = base.steps;\n    // В задачах обычно целое, но на всякий — округлим, если очень близко:\n    const stepsInt = Math.abs(Math.round(stepsRaw));\n    const sign = base.sign;\n\n    let x = W.x0;\n    let y = W.y0;\n\n    const seq = [{ x, y }];\n\n    if (W.op === "add") {\n      const dForward = forwardDeltaY();\n      const d = dForward * sign; // если идём назад — знак меняется\n      for (let i=0;i<stepsInt;i++){\n        x = x + sign * W.dx;\n        y = y + d;\n        seq.push({ x, y });\n      }\n    } else {\n      const fForward = forwardFactor();\n      const f = (sign === 1) ? fForward : (1 / fForward);\n      for (let i=0;i<stepsInt;i++){\n        x = x + sign * W.dx;\n        y = y * f;\n        seq.push({ x, y });\n      }\n    }\n    return { seq, stepsInt, sign, dxTotal: base.dxTotal };\n  }\n\n  function renderSeqTable(seq){\n    const t = document.createElement("table");\n    const thead = document.createElement("thead");\n    thead.innerHTML = `<tr><th>Шаг</th><th class="right">x</th><th class="right">y</th></tr>`;\n    t.appendChild(thead);\n    const tb = document.createElement("tbody");\n    seq.forEach((r, i) => {\n      const tr = document.createElement("tr");\n      tr.innerHTML = `<td>${i}</td><td class="right">${r.x}</td><td class="right">${r.y}</td>`;\n      tb.appendChild(tr);\n    });\n    t.appendChild(tb);\n    return t;\n  }\n\n  function renderStep4(){\n    const h = document.createElement("div");\n    h.innerHTML = `\n      <div class="q">Считаем по шагам</div>\n      <div class="qSub">Здесь мы делаем маленькие проверки ✅, чтобы не потеряться.</div>\n    `;\n    ui.stepBody.appendChild(h);\n\n    // Блок “что ищем”\n    const goalBlock = document.createElement("div");\n    goalBlock.className = "field";\n    goalBlock.innerHTML = `\n      <label>Что именно считаем сейчас?</label>\n      <select id="goalSel2">\n        <option value="value">Найти значение в точке x₁</option>\n        <option value="sum">Найти сумму первых n значений</option>\n        <option value="steps">Найти сколько шагов до условия</option>\n      </select>\n      <div class="hintSmall">Если система угадала не то — переключите.</div>\n    `;\n    const goalSel2 = goalBlock.querySelector("#goalSel2");\n    goalSel2.value = W.goal;\n    goalSel2.addEventListener("change", () => { W.goal = goalSel2.value; showStep(3); });\n    ui.stepBody.appendChild(goalBlock);\n\n    // В зависимости от цели — разные поля\n    if (W.goal === "value") renderStep4_Value();\n    if (W.goal === "sum") renderStep4_Sum();\n    if (W.goal === "steps") renderStep4_Steps();\n\n    ui.stepBody.appendChild(\n      navButtons(true, true, () => showStep(2), () => showStep(4))\n    );\n  }\n\n  function renderStep4_Value(){\n    const grid = document.createElement("div");\n    grid.className = "grid";\n\n    const fTarget = document.createElement("div");\n    fTarget.className = "field";\n    fTarget.innerHTML = `<label>Где нужно найти? (x₁)</label><input id="x1" type="text" placeholder="например: 1890 или 30" />`;\n    const x1 = fTarget.querySelector("#x1");\n    if (W.x1 !== null) x1.value = W.x1;\n    bindActive(x1);\n    x1.addEventListener("input", () => W.x1 = toNum(x1.value));\n\n    const fInfo = document.createElement("div");\n    fInfo.className = "field";\n    fInfo.innerHTML = `\n      <label>Что дальше?</label>\n      <div class="hintSmall">\n        1) Найди разницу по x: x₁ − x₀<br>\n        2) Сколько шагов: разница / Δx<br>\n        3) Сделай столько шагов и получи y₁\n      </div>\n    `;\n    grid.appendChild(fTarget);\n    grid.appendChild(fInfo);\n    ui.stepBody.appendChild(grid);\n\n    const canCompute = (W.x1 !== null && W.x0 !== null && W.y0 !== null && W.dx !== null);\n\n    const mini = document.createElement("div");\n    mini.className = "miniCheck";\n\n    const mkRow = (title, idInput, checkFn) => {\n      const row = document.createElement("div");\n      row.className = "miniRow";\n      row.innerHTML = `<b>${title}</b><input id="${idInput}" type="text" placeholder="впиши число" />`;\n      const inp = row.querySelector("input");\n      bindActive(inp);\n      const btn = document.createElement("button");\n      btn.className = "btn";\n      btn.textContent = "Проверить";\n      btn.addEventListener("click", () => checkFn(inp, row));\n      row.appendChild(btn);\n      return row;\n    };\n\n    let built = null;\n    if (canCompute) {\n      built = buildSequenceValue(W.x1);\n      if (built) {\n        W.computed.dxTotal = built.dxTotal;\n        W.computed.steps = built.stepsInt;\n        W.computed.sign = built.sign;\n        W.computed.yFinal = built.seq[built.seq.length-1].y;\n        W.seq = built.seq;\n      }\n    }\n\n    mini.appendChild(mkRow("1) Разница по x (x₁ − x₀)", "m_dx", (inp, row) => {\n      const v = toNum(inp.value);\n      if (!canCompute || !built) return;\n      if (approxEq(v, W.computed.dxTotal)) { row.classList.add("ok"); inp.disabled=true; W.m1_ok=true; }\n      else { row.classList.add("bad"); }\n      row.querySelector("button").className = W.m1_ok ? "btn good" : "btn bad";\n    }));\n\n    mini.appendChild(mkRow("2) Сколько шагов? (|разница| / Δx)", "m_steps", (inp, row) => {\n      const v = toNum(inp.value);\n      if (!canCompute || !built) return;\n      if (approxEq(v, W.computed.steps)) { row.classList.add("ok"); inp.disabled=true; W.m2_ok=true; }\n      else { row.classList.add("bad"); }\n      row.querySelector("button").className = W.m2_ok ? "btn good" : "btn bad";\n    }));\n\n    mini.appendChild(mkRow("3) Значение в точке x₁ (y₁)", "m_y1", (inp, row) => {\n      const v = toNum(inp.value);\n      if (!canCompute || !built) return;\n      if (approxEq(v, W.computed.yFinal)) { row.classList.add("ok"); inp.disabled=true; W.m3_ok=true; }\n      else { row.classList.add("bad"); }\n      row.querySelector("button").className = W.m3_ok ? "btn good" : "btn bad";\n    }));\n\n    ui.stepBody.appendChild(mini);\n\n    if (built && built.seq?.length) {\n      const seqBox = document.createElement("div");\n      seqBox.className = "field";\n      seqBox.innerHTML = `<label>Ряд по шагам (можно пролистать)</label>`;\n      seqBox.appendChild(renderSeqTable(built.seq));\n      const b = document.createElement("button");\n      b.className = "btn primary";\n      b.textContent = "Подставить y₁ в ответ";\n      b.addEventListener("click", () => {\n        const ans = $("finalAnswer");\n        if (ans) ans.value = String(W.computed.yFinal ?? "");\n      });\n      seqBox.appendChild(document.createElement("div")).style.height="10px";\n      seqBox.appendChild(b);\n      ui.stepBody.appendChild(seqBox);\n    } else {\n      const warn = document.createElement("div");\n      warn.className = "msg bad";\n      warn.textContent = "Заполни x₁, чтобы посчитать шаги.";\n      ui.stepBody.appendChild(warn);\n    }\n  }\n\n  function renderStep4_Sum(){\n    const grid = document.createElement("div");\n    grid.className = "grid";\n\n    const fN = document.createElement("div");\n    fN.className = "field";\n    fN.innerHTML = `<label>Сколько значений складываем? (n)</label><input id="n" type="text" placeholder="например: 8 или 12" />`;\n    const n = fN.querySelector("#n");\n    if (W.n !== null) n.value = W.n;\n    bindActive(n);\n    n.addEventListener("input", () => W.n = toNum(n.value));\n\n    const fInfo = document.createElement("div");\n    fInfo.className = "field";\n    fInfo.innerHTML = `\n      <label>Как считать сумму (без формул)</label>\n      <div class="hintSmall">\n        1) Выпиши ряд значений.<br>\n        2) Сложи “первое + последнее”, “второе + предпоследнее”…<br>\n        3) Если n нечётное — середина добавится отдельно.\n      </div>\n    `;\n\n    grid.appendChild(fN);\n    grid.appendChild(fInfo);\n    ui.stepBody.appendChild(grid);\n\n    const can = (W.n !== null && W.n > 0 && W.x0 !== null && W.y0 !== null);\n\n    if (!can) {\n      const warn = document.createElement("div");\n      warn.className = "msg bad";\n      warn.textContent = "Нужны x₀, y₀ и n.";\n      ui.stepBody.appendChild(warn);\n      return;\n    }\n\n    // строим n значений вперёд\n    let x = W.x0;\n    let y = W.y0;\n    const seq = [{x,y}];\n    const nInt = Math.round(W.n);\n\n    for (let i=1;i<nInt;i++){\n      if (W.op === "add"){\n        y = y + forwardDeltaY();\n      } else {\n        y = y * forwardFactor();\n      }\n      x = x + W.dx;\n      seq.push({x,y});\n    }\n    W.seq = seq;\n\n    // сумма\n    const sum = seq.reduce((acc,r) => acc + r.y, 0);\n    W.computed.sum = sum;\n\n    // микро: первый+последний\n    const pairSum = seq[0].y + seq[seq.length-1].y;\n    const pairs = Math.floor(nInt/2);\n    const mid = (nInt%2===1) ? seq[Math.floor(nInt/2)].y : 0;\n\n    const mini = document.createElement("div");\n    mini.className = "miniCheck";\n\n    const row1 = document.createElement("div");\n    row1.className = "miniRow";\n    row1.innerHTML = `<b>1) Первое + последнее</b><input id="m_pair" type="text" placeholder="впиши число" />`;\n    const inp1 = row1.querySelector("input"); bindActive(inp1);\n    const b1 = document.createElement("button"); b1.className="btn"; b1.textContent="Проверить";\n    b1.addEventListener("click", () => {\n      const v = toNum(inp1.value);\n      if (approxEq(v, pairSum)) { b1.className="btn good"; inp1.disabled=true; }\n      else { b1.className="btn bad"; }\n    });\n    row1.appendChild(b1);\n    mini.appendChild(row1);\n\n    const row2 = document.createElement("div");\n    row2.className = "miniRow";\n    row2.innerHTML = `<b>2) Сумма (сколько всего)</b><input id="m_sum" type="text" placeholder="впиши число" />`;\n    const inp2 = row2.querySelector("input"); bindActive(inp2);\n    const b2 = document.createElement("button"); b2.className="btn"; b2.textContent="Проверить";\n    b2.addEventListener("click", () => {\n      const v = toNum(inp2.value);\n      if (approxEq(v, sum)) { b2.className="btn good"; inp2.disabled=true; }\n      else { b2.className="btn bad"; }\n    });\n    row2.appendChild(b2);\n    mini.appendChild(row2);\n\n    ui.stepBody.appendChild(mini);\n\n    const seqBox = document.createElement("div");\n    seqBox.className = "field";\n    seqBox.innerHTML = `<label>Ряд значений (n=${nInt})</label>`;\n    seqBox.appendChild(renderSeqTable(seq));\n\n    const info = document.createElement("div");\n    info.className="hintSmall";\n    info.innerHTML = `Пары: ${pairs} шт. • (первое+последнее) = ${pairSum}` + (nInt%2===1 ? ` • середина = ${mid}` : "");\n    seqBox.appendChild(info);\n\n    const b = document.createElement("button");\n    b.className = "btn primary";\n    b.textContent = "Подставить сумму в ответ";\n    b.addEventListener("click", () => {\n      const ans = $("finalAnswer");\n      if (ans) ans.value = String(sum);\n    });\n    seqBox.appendChild(document.createElement("div")).style.height="10px";\n    seqBox.appendChild(b);\n\n    ui.stepBody.appendChild(seqBox);\n  }\n\n  function renderStep4_Steps(){\n    const grid = document.createElement("div");\n    grid.className = "grid";\n\n    const fCmp = document.createElement("div");\n    fCmp.className="field";\n    fCmp.innerHTML = `\n      <label>Условие остановки</label>\n      <select id="cmp">\n        <option value="<=">y стало ≤ …</option>\n        <option value=">=">y стало ≥ …</option>\n      </select>\n      <div style="height:10px"></div>\n      <label>Порог (…)</label>\n      <input id="lim" type="text" placeholder="например: 2" />\n    `;\n    const cmp = fCmp.querySelector("#cmp");\n    const lim = fCmp.querySelector("#lim");\n    cmp.value = W.limitCmp;\n    cmp.addEventListener("change", () => W.limitCmp = cmp.value);\n    if (W.limit !== null) lim.value = W.limit;\n    bindActive(lim);\n    lim.addEventListener("input", () => W.limit = toNum(lim.value));\n\n    const fInfo = document.createElement("div");\n    fInfo.className="field";\n    fInfo.innerHTML = `\n      <label>Как считаем (без формул)</label>\n      <div class="hintSmall">\n        Нажимаем “Сделать шаг” и смотрим, когда условие выполнится.<br>\n        Потом ответ — сколько шагов получилось.\n      </div>\n    `;\n\n    grid.appendChild(fCmp);\n    grid.appendChild(fInfo);\n    ui.stepBody.appendChild(grid);\n\n    const can = (W.limit !== null && W.x0 !== null && W.y0 !== null);\n    if (!can) {\n      const warn = document.createElement("div");\n      warn.className="msg bad";\n      warn.textContent = "Нужны x₀, y₀ и порог.";\n      ui.stepBody.appendChild(warn);\n      return;\n    }\n\n    // интерактивный счётчик шагов\n    let steps = 0;\n    let x = W.x0;\n    let y = W.y0;\n    const seq = [{x,y}];\n\n    const box = document.createElement("div");\n    box.className="field";\n    box.innerHTML = `<label>Счётчик</label>`;\n\n    const status = document.createElement("div");\n    status.className="hintSmall";\n    status.textContent = `Сейчас: шагов 0 • x=${x} • y=${y}`;\n    box.appendChild(status);\n\n    const btnRow = document.createElement("div");\n    btnRow.className="actions";\n\n    const stepBtn = document.createElement("button");\n    stepBtn.className="btn primary";\n    stepBtn.textContent="Сделать шаг";\n\n    const step5Btn = document.createElement("button");\n    step5Btn.className="btn";\n    step5Btn.textContent="Сделать 5 шагов";\n\n    function condOK(val){\n      return (W.limitCmp === "<=") ? (val <= W.limit) : (val >= W.limit);\n    }\n\n    function doOne(){\n      steps++;\n      x = x + W.dx;\n\n      if (W.op === "add"){\n        y = y + forwardDeltaY();\n      } else {\n        y = y * forwardFactor();\n      }\n      seq.push({x,y});\n      status.textContent = `Сейчас: шагов ${steps} • x=${x} • y=${y}`;\n\n      if (condOK(y)){\n        status.innerHTML = `✅ Условие выполнено на шаге ${steps}. (x=${x}, y=${y})`;\n        stepBtn.disabled = true;\n        step5Btn.disabled = true;\n      }\n    }\n    stepBtn.addEventListener("click", doOne);\n    step5Btn.addEventListener("click", () => { for(let i=0;i<5 && !stepBtn.disabled;i++) doOne(); });\n\n    btnRow.appendChild(stepBtn);\n    btnRow.appendChild(step5Btn);\n    box.appendChild(btnRow);\n\n    const ask = document.createElement("div");\n    ask.className="miniRow";\n    ask.innerHTML = `<b>Ответ: сколько шагов получилось?</b><input id="m_steps2" type="text" placeholder="впиши число" />`;\n    const inp = ask.querySelector("input");\n    bindActive(inp);\n\n    const checkBtn = document.createElement("button");\n    checkBtn.className="btn";\n    checkBtn.textContent="Проверить";\n    checkBtn.addEventListener("click", () => {\n      const v = toNum(inp.value);\n      if (approxEq(v, steps) && stepBtn.disabled) {\n        checkBtn.className="btn good";\n        inp.disabled = true;\n        // Можно подставить как ответ\n        const ans = $("finalAnswer");\n        if (ans) ans.value = String(steps);\n      } else {\n        checkBtn.className="btn bad";\n      }\n    });\n    ask.appendChild(checkBtn);\n    box.appendChild(ask);\n\n    box.appendChild(renderSeqTable(seq));\n    ui.stepBody.appendChild(box);\n  }\n\n  function renderStep5(){\n    const h = document.createElement("div");\n    h.innerHTML = `\n      <div class="q">Финал: введи ответ и проверь</div>\n      <div class="qSub">Можно нажать “подставить” на шаге 4, чтобы не ошибиться в цифрах.</div>\n    `;\n    ui.stepBody.appendChild(h);\n\n    const box = document.createElement("div");\n    box.className = "answerBox";\n    box.innerHTML = `\n      <div class="answerRow">\n        <input id="finalAnswer" type="text" placeholder="Ответ" />\n        <button class="btn primary" id="finalCheck">Проверить</button>\n        <button class="btn" id="finalShow">Показать правильный (для учёбы)</button>\n      </div>\n      <div class="msg" id="finalMsg"></div>\n      <div class="footerNote" id="finalCorrect"></div>\n    `;\n    ui.stepBody.appendChild(box);\n\n    const ans = box.querySelector("#finalAnswer");\n    bindActive(ans);\n\n    const msg = box.querySelector("#finalMsg");\n    const corr = box.querySelector("#finalCorrect");\n\n    function isCorrect(userStr){\n      const canon = getCanonicalAnswer(currentTask);\n      if (canon === null) return false;\n\n      const u = toNum(userStr);\n      const c = toNum(canon);\n\n      if (u !== null && c !== null) return approxEq(u, c);\n\n      // строковое сравнение как запасной вариант\n      const us = normNumStr(userStr);\n      const cs = normNumStr(canon);\n      if (us === cs) return true;\n\n      const alts = getAltAnswers(currentTask).map(normNumStr);\n      return alts.includes(us);\n    }\n\n    box.querySelector("#finalCheck").addEventListener("click", () => {\n      const ok = isCorrect(ans.value);\n      if (ok){\n        msg.textContent = "✅ Верно!";\n        msg.className = "msg ok";\n        corr.textContent = "";\n      } else {\n        msg.textContent = "❌ Неверно. Вернись на шаг 4 и проверь вычисления.";\n        msg.className = "msg bad";\n      }\n    });\n\n    box.querySelector("#finalShow").addEventListener("click", () => {\n      const canon = getCanonicalAnswer(currentTask);\n      corr.textContent = canon ? ("Правильный ответ: " + canon) : "В базе нет ответа для этой задачи.";\n    });\n\n    ui.stepBody.appendChild(\n      navButtons(true, true, () => showStep(3), () => newTask())\n    );\n  }\n\n  // ---------------------------\n  // Быстрый режим\n  // ---------------------------\n  function quickCheck(){\n    const canon = getCanonicalAnswer(currentTask);\n    if (!canon) {\n      ui.quickMsg.textContent = "В базе нет ответа для этой задачи.";\n      ui.quickMsg.className = "msg bad";\n      return;\n    }\n    const u = toNum(ui.quickAnswer.value);\n    const c = toNum(canon);\n\n    let ok = false;\n    if (u !== null && c !== null) ok = approxEq(u, c);\n    else ok = normNumStr(ui.quickAnswer.value) === normNumStr(canon);\n\n    if (ok){\n      ui.quickMsg.textContent = "✅ Верно!";\n      ui.quickMsg.className = "msg ok";\n      ui.quickCorrect.textContent = "";\n    } else {\n      ui.quickMsg.textContent = "❌ Неверно.";\n      ui.quickMsg.className = "msg bad";\n      ui.quickCorrect.textContent = "Правильный ответ: " + canon;\n    }\n  }\n\n  // ---------------------------\n  // Загрузка банка\n  // ---------------------------\n  async function boot(){\n    ui.topicSelect.innerHTML = `<option value="all">Все</option>`;\n    ui.taskText.textContent = "Загружаю базу…";\n\n    try{\n      const res = await fetch(DATA_URL, { cache: "no-store" });\n      if (!res.ok) throw new Error("HTTP " + res.status);\n      const json = await res.json();\n      const tasks = Array.isArray(json) ? json : (json.tasks || json.items || []);\n      if (!Array.isArray(tasks) || tasks.length === 0) throw new Error("В JSON нет tasks или он пустой.");\n\n      TASKS = tasks;\n\n      // темы\n      const topics = Array.from(new Set(TASKS.map(getTopic).filter(Boolean))).sort();\n      for (const t of topics){\n        const opt = document.createElement("option");\n        opt.value = t;\n        opt.textContent = t;\n        ui.topicSelect.appendChild(opt);\n      }\n\n      // события\n      ui.topicSelect.addEventListener("change", newTask);\n      ui.newBtn.addEventListener("click", newTask);\n      ui.resetBtn.addEventListener("click", () => {\n        ui.topicSelect.value = "all";\n        setUIMode("steps");\n        newTask();\n      });\n\n      ui.uiMode.addEventListener("change", () => setUIMode(ui.uiMode.value));\n      ui.modeStepsBtn.addEventListener("click", () => setUIMode("steps"));\n      ui.modeQuickBtn.addEventListener("click", () => setUIMode("quick"));\n\n      ui.quickCheckBtn.addEventListener("click", quickCheck);\n      ui.quickAnswer.addEventListener("keydown", (e) => { if (e.key === "Enter") quickCheck(); });\n\n      setUIMode("steps");\n      newTask();\n\n    }catch(e){\n      ui.taskText.textContent =\n        "Ошибка: база задач не загрузилась.\n" +\n        "Проверьте, что файл существует по пути:\n" + DATA_URL + "\n\n" +\n        "Текст ошибки: " + (e?.message || e);\n      ui.numPad.style.display="none";\n    }\n  }\n\n  boot();\n})();\n</script>\n</body>\n</html>\nEOF
