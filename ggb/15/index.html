<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GeoGebra Classic (offline)</title>
    <script src="../../GeoGebra/deployggb.js"></script>
    <style>
      body {
        margin: 0;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
        background: #fff;
        color: #111;
      }

      .page {
        max-width: 1200px;
        margin: 0 auto;
        padding: 16px;
      }

      .ggb-wrapper {
        max-width: 100%;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        overflow: hidden;
        background: #f8fafc;
      }

      .ggb-element {
        width: 100%;
        min-height: 480px;
        height: 70vh;
        max-height: 820px;
      }
    </style>
  </head>
  <body>
    <main class="page">
      <h1>GeoGebra Classic (offline)</h1>
      <p>
        Апплет загружается локально без обращений к geogebra.org.
      </p>
      <div class="ggb-wrapper">
        <div id="ggb-element" class="ggb-element"></div>
      </div>
    </main>

    <script>
      const params = {
        appName: "classic",
        filename: "../15.ggb",
        showToolBar: true,
        showAlgebraInput: true,
        showMenuBar: false,
      };

      const applet = new GGBApplet(params, true);
      applet.setHTML5Codebase("../../GeoGebra/HTML5/5.0/web3d/");

      const offlineHosts = ["geogebra.org", "cdn.geogebra.org"];
      const warnIfRemote = (url) => {
        if (!url || typeof url !== "string") return;
        if (offlineHosts.some((host) => url.includes(host))) {
          console.warn(
            "[GeoGebra Offline] Обнаружен запрос к удалённому домену:",
            url,
            "\nПроверьте оффлайн-режим: DevTools → Network → фильтр geogebra.org (должно быть 0)."
          );
        }
      };

      if ("PerformanceObserver" in window) {
        try {
          const observer = new PerformanceObserver((list) => {
            list.getEntries().forEach((entry) => warnIfRemote(entry.name));
          });
          observer.observe({ entryTypes: ["resource"] });
        } catch (error) {
          console.debug("[GeoGebra Offline] PerformanceObserver unavailable", error);
        }
      }

      window.addEventListener("load", () => {
        applet.inject("ggb-element");
      });
    </script>
  </body>
</html>
