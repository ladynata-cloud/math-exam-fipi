<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Деление уголком (тетрадный формат) — тренажёр</title>
  <link rel="stylesheet" href="../../style.css" />

  <style>
    :root{
      --cell: 34px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --ink: #0f172a;
      --soft: rgba(15,23,42,.08);
      --accent: rgba(47,95,115,.20);
      --ok: rgba(34,197,94,.18);
      --bad: rgba(239,68,68,.16);
      --hi: rgba(245,158,11,.22);
    }

    .wrap { max-width: 1200px; margin: 0 auto; padding: 14px; }
    h1 { margin: 0 0 6px; font-size: 20px; }
    .sub { margin: 0 0 14px; color: var(--muted); }

    .layout{
      display: grid;
      grid-template-columns: 1.5fr .9fr;
      gap: 12px;
      align-items: start;
    }
    @media (max-width: 980px){
      .layout{ grid-template-columns: 1fr; }
    }

    .paperCard{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }

    /* “Тетрадный” фон */
    .paper{
      border-radius: 14px;
      padding: 14px;
      background:
        radial-gradient(circle at 1px 1px, rgba(15,23,42,.10) 1px, transparent 1.4px) 0 0 / 18px 18px,
        linear-gradient(#fff, #fff);
      border: 1px solid rgba(15,23,42,.08);
      overflow: auto;
    }

    .divGrid{
      display: grid;
      grid-template-columns: auto auto;
      align-items: start;
      gap: 14px;
    }

    .leftArea{ min-width: calc(var(--cell) * 6); }

    .digitsRow{
      font-family: var(--mono);
      font-size: 28px;
      line-height: 1;
      display: flex;
      gap: 2px;
      align-items: center;
      color: var(--ink);
    }
    .cell{
      width: var(--cell);
      display: inline-flex;
      justify-content: center;
      align-items: center;
      padding: 4px 0;
      border-radius: 10px;
    }
    .cell.hi{ background: var(--hi); }
    .cell.soft{ background: rgba(15,23,42,.05); }

    .rightBox{
      position: relative;
      padding-left: 12px;
      border-left: 3px solid rgba(15,23,42,.45);
      border-top: 3px solid rgba(15,23,42,.45);
      border-radius: 6px;
      min-width: 210px;
    }
    .divisor{
      font-family: var(--mono);
      font-size: 30px;
      line-height: 1;
      padding: 4px 0 10px;
      display:flex;
      gap:2px;
      justify-content:flex-start;
    }
    .quotient{
      font-family: var(--mono);
      font-size: 30px;
      line-height: 1;
      padding: 10px 0 4px;
      border-top: 2px solid rgba(15,23,42,.35);
      display:flex;
      gap:2px;
      flex-wrap: nowrap;
    }

    .qInput{
      width: var(--cell);
      height: 42px;
      font-family: var(--mono);
      font-size: 28px;
      text-align: center;
      border-radius: 10px;
      border: 1px solid rgba(15,23,42,.20);
      outline: none;
      background: #fff;
    }
    .qInput:focus{ border-color: rgba(47,95,115,.60); box-shadow: 0 0 0 4px rgba(47,95,115,.12); }

    .work{
      margin-top: 10px;
      font-family: var(--mono);
      font-size: 28px;
      line-height: 1.05;
      color: var(--ink);
    }

    .rowNum{
      display: flex;
      align-items: center;
      gap: 2px;
      margin: 2px 0;
    }
    .rowNum .minus{
      width: var(--cell);
      display: inline-flex;
      justify-content: center;
      opacity: .9;
    }

    .numInput{
      height: 42px;
      font-family: var(--mono);
      font-size: 26px;
      text-align: center;
      border-radius: 10px;
      border: 1px solid rgba(15,23,42,.20);
      outline: none;
      background: #fff;
      padding: 0 10px;
    }
    .numInput:focus{ border-color: rgba(47,95,115,.60); box-shadow: 0 0 0 4px rgba(47,95,115,.12); }

    .line{
      height: 0;
      border-top: 2px solid rgba(15,23,42,.35);
      margin: 6px 0 6px;
    }

    .answerLine{
      margin-top: 10px;
      font-size: 14px;
      color: var(--muted);
    }
    .answerLine b{ color: var(--text); }

    .panel{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      position: sticky;
      top: 70px;
    }
    .panel h2{ margin:0 0 10px; font-size: 14px; }
    .panel .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
      margin: 10px 0;
    }
    label{ font-size: 12px; color: var(--muted); }

    input[type="number"], input[type="text"]{
      width: 100%;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(15,23,42,.18);
      outline: none;
      font-size: 14px;
    }
    input[type="number"]:focus, input[type="text"]:focus{
      border-color: rgba(47,95,115,.60);
      box-shadow: 0 0 0 4px rgba(47,95,115,.12);
    }

    .btnWide{
      width:100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(47,95,115,.25);
      background: rgba(47,95,115,.10);
      color: #2f5f73;
      font-weight: 900;
      cursor:pointer;
    }
    .btnWide:hover{ filter: brightness(.98); }

    .mini{
      font-size: 12px;
      color: var(--muted);
      margin-top: 8px;
      line-height: 1.45;
      white-space: pre-line;
    }

    .status{
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(15,23,42,.04);
      border: 1px solid rgba(15,23,42,.08);
      margin-top: 10px;
      font-size: 13px;
    }
    .status.ok{ background: var(--ok); border-color: rgba(34,197,94,.25); }
    .status.bad{ background: var(--bad); border-color: rgba(239,68,68,.25); }

    .hint{
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      white-space: pre-line;
    }

    .linkRow{ margin-top: 10px; display:flex; gap:10px; flex-wrap:wrap; }
    .linkBtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid rgba(15,23,42,.12);
      background: rgba(255,255,255,.7);
      color: var(--text);
      font-weight: 800;
      font-size: 12px;
      text-decoration: none;
    }
  </style>
</head>

<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <div class="brand-title">MathExam</div>
        <div class="brand-sub">Тренажёры письменных навыков</div>
      </div>
      <nav class="nav">
        <a class="nav-link" href="../../">Главная</a>
        <a class="nav-link" href="../">Тренажёры</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <h1>Деление уголком — тетрадный формат</h1>
    <p class="sub">Уровни: 1) только цифра частного • 2) + произведение и вычитание • 3) + следующий блок (сносим цифру).</p>

    <div class="layout">
      <section class="paperCard">
        <div class="paper" id="paper">
          <div class="divGrid">
            <div class="leftArea">
              <div class="digitsRow" id="dividendRow"></div>
              <div class="work" id="work"></div>
              <div class="answerLine" id="answerLine"></div>
            </div>

            <div class="rightBox">
              <div class="divisor" id="divisorRow"></div>
              <div class="quotient" id="quotientRow"></div>
            </div>
          </div>
        </div>
      </section>

      <aside class="panel">
        <h2>Управление</h2>

        <div class="field">
          <label>Делимое</label>
          <input id="inDividend" type="number" min="0" step="1" value="41608" />
        </div>

        <div class="field">
          <label>Делитель</label>
          <input id="inDivisor" type="number" min="1" step="1" value="56" />
        </div>

        <div class="row">
          <button class="btnWide" id="btnStart">Старт / обновить пример</button>
        </div>

        <div class="field">
          <label>Уровень</label>
          <div class="row" style="gap:12px">
            <label style="display:flex;align-items:center;gap:6px;font-size:13px;color:var(--text)">
              <input type="radio" name="lvl" value="1" checked />
              1 — только q
            </label>
            <label style="display:flex;align-items:center;gap:6px;font-size:13px;color:var(--text)">
              <input type="radio" name="lvl" value="2" />
              2 — q + умножение + вычитание
            </label>
            <label style="display:flex;align-items:center;gap:6px;font-size:13px;color:var(--text)">
              <input type="radio" name="lvl" value="3" />
              3 — полный шаг (+ следующий блок)
            </label>
          </div>
        </div>

        <div class="field">
          <label style="display:flex;align-items:center;gap:8px;color:var(--text)">
            <input id="calmMode" type="checkbox" checked />
            Режим спокойствия (объяснять “мало/велико”)
          </label>
        </div>

        <div class="row">
          <button class="btnWide" id="btnCheck">Проверить шаг</button>
        </div>

        <div id="status" class="status" style="display:none"></div>
        <div id="hint" class="hint"></div>

        <div class="linkRow">
          <a class="linkBtn" href="./long-multiplication.html">Перейти к умножению столбиком</a>
          <a class="linkBtn" href="../multiplication-table/">Таблица умножения</a>
        </div>

        <div class="mini" id="miniLog"></div>
      </aside>
    </div>
  </main>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const elDividendRow = $("dividendRow");
  const elDivisorRow = $("divisorRow");
  const elQuotientRow = $("quotientRow");
  const elWork = $("work");
  const elAnswer = $("answerLine");
  const elStatus = $("status");
  const elHint = $("hint");
  const elMiniLog = $("miniLog");

  const inDividend = $("inDividend");
  const inDivisor = $("inDivisor");
  const btnStart = $("btnStart");
  const btnCheck = $("btnCheck");
  const calmMode = $("calmMode");

  function getLevel(){
    const r = document.querySelector('input[name="lvl"]:checked');
    return Number(r ? r.value : 1);
  }

  function digitsOf(n){ return String(Math.floor(Math.abs(n))).split(""); }

  function clampInt(v){
    if (v === "" || v === null || v === undefined) return null;
    const s = String(v).trim();
    if (!/^-?\d+$/.test(s)) return null;
    return Number(s);
  }

  function makeCell(ch, cls=""){
    const sp = document.createElement("span");
    sp.className = "cell" + (cls ? (" " + cls) : "");
    sp.textContent = ch;
    return sp;
  }

  function renderNumberRow(container, strDigits, hiToIdx = -1, hiSingleIdx = -1){
    container.innerHTML = "";
    for (let i=0;i<strDigits.length;i++){
      let cls = "";
      if (hiSingleIdx === i) cls = "hi";
      else if (hiToIdx >= 0 && i <= hiToIdx) cls = "soft";
      container.appendChild(makeCell(strDigits[i], cls));
    }
  }

  function rowOffsetPx(cells){ return `calc(var(--cell) * ${cells})`; }

  function renderRowNumber({minus=false, numberStr, endPos, highlightLast=false, asInput=false, inputId="", inputWidthDigits=3, inputValue=""}){
    const digitsLen = numberStr.length;
    const startPos = (endPos + 1) - digitsLen;
    const rowStart = minus ? Math.max(0, startPos - 1) : startPos;

    const row = document.createElement("div");
    row.className = "rowNum";
    row.style.marginLeft = rowOffsetPx(rowStart);

    if (minus){
      const m = document.createElement("span");
      m.className = "minus";
      m.textContent = "−";
      row.appendChild(m);
    }

    const leftPadCells = minus ? (startPos - rowStart) : 0;
    if (leftPadCells > 0){
      const pad = document.createElement("span");
      pad.style.width = `calc(var(--cell) * ${leftPadCells})`;
      row.appendChild(pad);
    }

    if (asInput){
      const inp = document.createElement("input");
      inp.className = "numInput";
      inp.type = "text";
      inp.inputMode = "numeric";
      inp.autocomplete = "off";
      inp.spellcheck = false;
      inp.id = inputId;
      inp.value = inputValue;
      inp.style.width = `calc(var(--cell) * ${Math.max(2, inputWidthDigits)})`;
      row.appendChild(inp);
      return row;
    }

    for (let i=0;i<numberStr.length;i++){
      const isLast = (i === numberStr.length - 1);
      row.appendChild(makeCell(numberStr[i], (highlightLast && isLast) ? "hi" : ""));
    }
    return row;
  }

  function renderLine(endPos, widthDigits){
    const startPos = (endPos + 1) - widthDigits;
    const line = document.createElement("div");
    line.className = "line";
    line.style.marginLeft = rowOffsetPx(startPos);
    line.style.width = `calc(var(--cell) * ${widthDigits})`;
    return line;
  }

  function buildSteps(dividend, divisor){
    const ds = String(dividend);
    const digits = ds.split("").map(d => Number(d));
    let rem = 0;
    let started = false;
    let steps = [];
    let firstEndPos = -1;

    for (let i=0;i<digits.length;i++){
      rem = rem*10 + digits[i];

      if (!started){
        if (rem >= divisor){
          started = true;
          firstEndPos = i;
        } else {
          continue;
        }
      }

      const chunk = rem;
      const q = Math.floor(chunk / divisor);
      const prod = q * divisor;
      const newRem = chunk - prod;

      steps.push({
        i,
        chunk,
        q,
        prod,
        remAfter: newRem,
        chunkStr: String(chunk),
        prodStr: String(prod),
        remStr: String(newRem),
        broughtDigit: digits[i],
      });

      rem = newRem;
    }

    const quotientStr = steps.map(s => String(s.q)).join("") || "0";
    return {
      digitsStr: ds,
      digits,
      firstEndPos,
      steps,
      quotientStr,
      remainder: rem
    };
  }

  let state = {
    dividend: 41608,
    divisor: 56,
    model: null,
    stepIdx: 0,
    answers: [] // {q, prod, rem, nextChunk}
  };

  function resetAll(){
    const dividend = clampInt(inDividend.value);
    const divisor = clampInt(inDivisor.value);

    if (!Number.isFinite(dividend) || dividend < 0){
      showStatus("bad", "Делимое должно быть целым числом ≥ 0.");
      return;
    }
    if (!Number.isFinite(divisor) || divisor <= 0){
      showStatus("bad", "Делитель должен быть целым числом > 0.");
      return;
    }

    const model = buildSteps(dividend, divisor);

    if (model.steps.length === 0){
      // Делимое < делителя
      state = { dividend, divisor, model, stepIdx: 0, answers: [] };
      render();
      showStatus("ok", "Делимое меньше делителя: частное 0, остаток = делимое.");
      return;
    }

    state = { dividend, divisor, model, stepIdx: 0, answers: model.steps.map(() => ({q:"", prod:"", rem:"", nextChunk:""})) };
    render();
    showStatus(null, "");
  }

  function showStatus(kind, text){
    if (!text){
      elStatus.style.display = "none";
      elStatus.className = "status";
      elStatus.textContent = "";
      return;
    }
    elStatus.style.display = "block";
    elStatus.className = "status" + (kind ? (" " + kind) : "");
    elStatus.textContent = text;
  }

  function setHint(text){ elHint.textContent = text || ""; }

  function render(){
    const m = state.model;
    const digitsStr = m.digitsStr;

    // Dividend highlight:
    // - подсветим “рабочую” цифру (ту, что сейчас сносим/используем)
    const curStep = m.steps[state.stepIdx] || null;
    const hiIdx = curStep ? curStep.i : -1;
    const softTo = m.firstEndPos;

    renderNumberRow(elDividendRow, digitsStr.split(""), softTo, hiIdx);

    // Divisor
    elDivisorRow.innerHTML = "";
    String(state.divisor).split("").forEach(ch => elDivisorRow.appendChild(makeCell(ch)));

    // Quotient area (по шагам)
    elQuotientRow.innerHTML = "";
    const lvl = getLevel();

    m.steps.forEach((s, idx) => {
      if (idx < state.stepIdx){
        const ch = String(m.steps[idx].q);
        elQuotientRow.appendChild(makeCell(ch));
      } else if (idx === state.stepIdx){
        const inp = document.createElement("input");
        inp.className = "qInput";
        inp.type = "text";
        inp.inputMode = "numeric";
        inp.maxLength = 1;
        inp.autocomplete = "off";
        inp.spellcheck = false;
        inp.id = "qInput";
        inp.value = state.answers[idx]?.q ?? "";
        elQuotientRow.appendChild(inp);
        // autofocus
        setTimeout(() => inp.focus(), 30);
      } else {
        elQuotientRow.appendChild(makeCell("·", "soft"));
      }
    });

    // Work rows
    elWork.innerHTML = "";

    // Первый шаг: не пишем “блок” отдельно, он виден в делимом.
    // Со второго шага показываем блок (остаток + снесённая цифра) отдельной строкой.
    for (let idx=0; idx<m.steps.length; idx++){
      const s = m.steps[idx];
      const endPos = s.i;

      const isDone = idx < state.stepIdx;
      const isCur = idx === state.stepIdx;

      // Блок перед действием (кроме первого шага)
      if (idx > 0){
        // показываем блок строки: например 240, 168...
        const blockStr = String(s.chunk);
        const row = renderRowNumber({
          minus:false,
          numberStr:blockStr,
          endPos:endPos,
          highlightLast:true,
          asInput: (isCur && lvl === 3),
          inputId: "nextChunkInput",
          inputWidthDigits: blockStr.length,
          inputValue: state.answers[idx]?.nextChunk ?? ""
        });
        elWork.appendChild(row);
      }

      // Произведение (минусом)
      const prodStr = String(s.prod);
      const prodRow = renderRowNumber({
        minus:true,
        numberStr: prodStr,
        endPos:endPos,
        highlightLast:false,
        asInput: (isCur && lvl >= 2),
        inputId: "prodInput",
        inputWidthDigits: prodStr.length,
        inputValue: state.answers[idx]?.prod ?? ""
      });
      elWork.appendChild(prodRow);

      // Линия
      const widthDigits = Math.max(String(s.chunk).length, String(s.prod).length);
      elWork.appendChild(renderLine(endPos, widthDigits));

      // Остаток
      const remStr = String(s.remAfter);
      const remRow = renderRowNumber({
        minus:false,
        numberStr: remStr,
        endPos:endPos,
        highlightLast:false,
        asInput: (isCur && lvl >= 2),
        inputId: "remInput",
        inputWidthDigits: remStr.length,
        inputValue: state.answers[idx]?.rem ?? ""
      });
      elWork.appendChild(remRow);

      // Доп. линия между шагами (как в тетради часто оставляют маленький зазор)
      if (idx < m.steps.length - 1){
        const spacer = document.createElement("div");
        spacer.style.height = "8px";
        elWork.appendChild(spacer);
      }

      // Если ещё не дошли — не рисуем дальше (чтобы было “пошагово”)
      if (!isDone && !isCur) break;
    }

    // Answer line
    if (m.steps.length === 0){
      elAnswer.innerHTML = `Ответ: <b>${state.dividend}</b> : <b>${state.divisor}</b> = <b>0</b> (остаток <b>${state.dividend}</b>)`;
    } else {
      const doneQ = m.steps.slice(0, state.stepIdx).map(s => s.q).join("");
      const qShown = doneQ || "…";
      elAnswer.innerHTML = `Ответ: <b>${state.dividend}</b> : <b>${state.divisor}</b> = <b>${qShown}</b>${state.stepIdx >= m.steps.length ? ` (остаток <b>${m.remainder}</b>)` : ""}`;
    }

    // mini log
    elMiniLog.textContent = buildMiniLog();
    setHint(buildHintText());
  }

  function buildHintText(){
    const m = state.model;
    if (!m || m.steps.length === 0) return "";

    const s = m.steps[state.stepIdx];
    const stepNo = state.stepIdx + 1;

    let t = `Шаг ${stepNo}/${m.steps.length}\n`;
    t += `Текущий блок: ${s.chunk}\n`;
    t += `Нужно подобрать q так, чтобы ${state.divisor}×q ≤ ${s.chunk} и ${state.divisor}×(q+1) > ${s.chunk}.\n`;
    if (getLevel() >= 2){
      t += `Потом умножаем: ${state.divisor}×q = произведение, и вычитаем из блока.\n`;
    }
    if (getLevel() === 3 && state.stepIdx > 0){
      t += `На уровне 3 ещё вводим сам блок (снесли цифру и получили число для деления).\n`;
    }
    return t;
  }

  function buildMiniLog(){
    const m = state.model;
    if (!m) return "";
    if (m.steps.length === 0) return "Делимое меньше делителя — деление в столбик не требуется.";

    let out = "";
    for (let i=0;i<m.steps.length;i++){
      const s = m.steps[i];
      if (i > state.stepIdx) break;
      if (i === state.stepIdx){
        out += `Сейчас: блок=${s.chunk}, делитель=${state.divisor}\n`;
        out += `Введи q (и на уровнях 2–3 ещё умножение/вычитание).\n`;
      } else {
        out += `Шаг ${i+1}: блок=${s.chunk}, q=${s.q}, произведение=${s.prod}, остаток=${s.remAfter}\n`;
      }
    }
    return out.trim();
  }

  function checkCurrentStep(){
    const m = state.model;
    if (!m || m.steps.length === 0) return;

    const idx = state.stepIdx;
    const s = m.steps[idx];
    const lvl = getLevel();

    const qEl = document.getElementById("qInput");
    const prodEl = document.getElementById("prodInput");
    const remEl = document.getElementById("remInput");
    const nextChunkEl = document.getElementById("nextChunkInput");

    const qVal = qEl ? clampInt(qEl.value) : null;
    if (!Number.isFinite(qVal) || qVal < 0 || qVal > 9){
      showStatus("bad", "Введите цифру q (0–9).");
      return;
    }

    state.answers[idx].q = String(qVal);

    // q check
    if (qVal !== s.q){
      const cm = calmMode.checked;
      if (cm){
        if (qVal < s.q){
          const test = state.divisor * (qVal + 1);
          showStatus("bad", `q = ${qVal} — мало. Проверка: ${state.divisor}×(${qVal}+1) = ${test} ${test <= s.chunk ? "≤" : ">"} ${s.chunk}.`);
        } else {
          const test = state.divisor * qVal;
          showStatus("bad", `q = ${qVal} — велико. Проверка: ${state.divisor}×${qVal} = ${test} > ${s.chunk}.`);
        }
      } else {
        showStatus("bad", "Неверно. Подбери другую цифру q.");
      }
      return;
    }

    // if lvl >=2 check prod and rem
    if (lvl >= 2){
      const prodVal = prodEl ? clampInt(prodEl.value) : null;
      const remVal = remEl ? clampInt(remEl.value) : null;

      if (!Number.isFinite(prodVal)){
        showStatus("bad", "Введите произведение (делитель × q).");
        return;
      }
      if (!Number.isFinite(remVal)){
        showStatus("bad", "Введите остаток (блок − произведение).");
        return;
      }

      state.answers[idx].prod = String(prodVal);
      state.answers[idx].rem = String(remVal);

      if (prodVal !== s.prod){
        showStatus("bad", `Произведение неверно. Должно быть ${state.divisor}×${s.q} = ${s.prod}.`);
        return;
      }
      if (remVal !== s.remAfter){
        showStatus("bad", `Вычитание неверно. ${s.chunk} − ${s.prod} = ${s.remAfter}.`);
        return;
      }
    }

    // lvl 3: nextChunk input (только если idx>0, потому что у первого шага блок не вводим отдельной строкой)
    if (lvl === 3 && idx > 0){
      const nextChunkVal = nextChunkEl ? clampInt(nextChunkEl.value) : null;
      if (!Number.isFinite(nextChunkVal)){
        showStatus("bad", "Введите блок (число, полученное после сноса цифры).");
        return;
      }
      state.answers[idx].nextChunk = String(nextChunkVal);
      if (nextChunkVal !== s.chunk){
        showStatus("bad", `Блок введён неверно. Здесь должен быть блок ${s.chunk}.`);
        return;
      }
    }

    // Success
    showStatus("ok", "Верно. Переходим к следующему шагу.");
    state.stepIdx++;

    if (state.stepIdx >= m.steps.length){
      // Finished
      render();
      showStatus("ok", `Готово! Частное = ${m.quotientStr}, остаток = ${m.remainder}.`);
      return;
    }

    render();
  }

  btnStart.addEventListener("click", resetAll);
  btnCheck.addEventListener("click", checkCurrentStep);

  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter"){
      const active = document.activeElement;
      // Если фокус в любом из полей тренажёра — проверяем шаг
      if (active && (active.id === "qInput" || active.id === "prodInput" || active.id === "remInput" || active.id === "nextChunkInput")){
        e.preventDefault();
        checkCurrentStep();
      }
    }
  });

  // init
  resetAll();
})();
</script>
</body>
</html>

