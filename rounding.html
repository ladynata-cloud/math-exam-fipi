<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–¢—Ä–µ–Ω–∞–∂—ë—Ä –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è ‚Äî mathexam.space</title>
    <style>
        :root {
            color-scheme: dark;
            --bg0: #0f172a;
            --bg1: #1e293b;
            --card: #121f36;
            --line: rgba(255, 255, 255, .12);
            --txt: rgba(255, 255, 255, .92);
            --muted: rgba(255, 255, 255, .72);
            --muted2: rgba(255, 255, 255, .55);
            --good: #10b981;
            --bad: #ef4444;
            --accent: #7aa7ff;
            --warning: #f59e0b;
            --shadow: 0 12px 30px rgba(0, 0, 0, .45);
            --r: 16px;
            --pad: 20px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--bg0);
            color: var(--txt);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            padding: var(--pad);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--accent), #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--muted);
            font-size: 1.1em;
        }

        .stats-bar {
            background: var(--bg1);
            border-radius: var(--r);
            padding: var(--pad);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            border: 1px solid var(--line);
            box-shadow: var(--shadow);
        }

        .stats {
            font-size: 1.1em;
        }

        .stats span {
            font-weight: bold;
            color: var(--accent);
        }

        #resetStats {
            background: var(--bad);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        #resetStats:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .card {
            background: var(--card);
            border-radius: var(--r);
            padding: var(--pad);
            margin-bottom: 25px;
            border: 1px solid var(--line);
            box-shadow: var(--shadow);
        }

        .task-display {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        .task-label {
            color: var(--muted);
            font-size: 1em;
            margin-bottom: 10px;
            display: block;
        }

        #task {
            font-size: 2.2em;
            font-weight: 700;
            color: var(--txt);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        #userAnswer {
            flex: 1;
            min-width: 200px;
            padding: 18px 20px;
            font-size: 1.4em;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid var(--accent);
            border-radius: 12px;
            color: var(--txt);
            outline: none;
            transition: all 0.3s;
        }

        #userAnswer:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: #a78bfa;
            box-shadow: 0 0 0 3px rgba(122, 167, 255, 0.2);
        }

        #userAnswer:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        #checkBtn {
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            min-width: 150px;
        }

        #checkBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(122, 167, 255, 0.3);
        }

        #checkBtn:active:not(:disabled) {
            transform: translateY(0);
        }

        #checkBtn:disabled {
            background: var(--muted2);
            cursor: not-allowed;
            transform: none !important;
        }

        .result-container {
            margin: 25px 0;
            min-height: 100px;
        }

        #result {
            padding: 25px;
            border-radius: 12px;
            font-size: 1.4em;
            text-align: center;
            font-weight: 600;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 10px;
        }

        #result.correct {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            border: 2px solid #10b981;
        }

        #result.incorrect {
            background: rgba(239, 68, 68, 0.15);
            color: #fca5a5;
            border: 2px solid #ef4444;
        }

        .rule-hint {
            font-size: 0.9em;
            color: var(--muted);
            font-weight: normal;
            font-style: italic;
            margin-top: 10px;
        }

        .rules-section {
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
        }

        .rules-header {
            padding: 20px;
            background: rgba(122, 167, 255, 0.1);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .rules-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .rules-content.show {
            padding: 20px;
            max-height: 500px;
        }

        .rules-content ul {
            list-style: none;
            padding-left: 0;
        }

        .rules-content li {
            margin-bottom: 15px;
            padding-left: 25px;
            position: relative;
        }

        .rules-content li:before {
            content: "‚Ä¢";
            color: var(--accent);
            font-size: 1.5em;
            position: absolute;
            left: 0;
            top: -5px;
        }

        .example {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            margin-top: 8px;
            font-family: 'Courier New', monospace;
        }

        .footer {
            text-align: center;
            color: var(--muted2);
            font-size: 0.9em;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--line);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #8b5cf6);
            width: 0%;
            transition: width 1s ease-in-out;
            border-radius: 3px;
        }

        .level-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .level-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--line);
            border-radius: 8px;
            color: var(--muted);
            cursor: pointer;
            transition: all 0.3s;
        }

        .level-btn.active {
            background: rgba(122, 167, 255, 0.2);
            color: var(--accent);
            border-color: var(--accent);
        }

        .level-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.12);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }
            
            #task {
                font-size: 1.8em;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            #userAnswer, #checkBtn {
                width: 100%;
            }
            
            .stats-bar {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
            }
            
            #resetStats {
                align-self: center;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            
            .container {
                padding: 0;
            }
            
            h1 {
                font-size: 1.7em;
            }
            
            #task {
                font-size: 1.5em;
            }
            
            .card {
                padding: 15px;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            background: var(--accent);
            opacity: 0;
            pointer-events: none;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(1000px) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üî¢ –¢—Ä–µ–Ω–∞–∂—ë—Ä –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è</h1>
            <p class="subtitle">–û—Ç—Ä–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–≤—ã–∫ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è —á–∏—Å–µ–ª –¥–æ –¥–µ—Å—è—Ç–∫–æ–≤ –∏ —Å–æ—Ç–µ–Ω</p>
        </header>

        <div class="stats-bar">
            <div class="stats">
                üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: <span id="statsCounter">–†–µ—à–µ–Ω–æ: 0 | –í–µ—Ä–Ω–æ: 0 (0%)</span>
            </div>
            <button id="resetStats">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
        </div>

        <div class="card">
            <div class="level-selector">
                <button class="level-btn active" data-level="1">–£—Ä–æ–≤–µ–Ω—å 1: –î–æ –¥–µ—Å—è—Ç–∫–æ–≤</button>
                <button class="level-btn" data-level="2">–£—Ä–æ–≤–µ–Ω—å 2: –î–æ —Å–æ—Ç–µ–Ω</button>
                <button class="level-btn" data-level="3">–°–ª—É—á–∞–π–Ω—ã–π</button>
            </div>

            <div class="task-display">
                <span class="task-label">–ó–∞–¥–∞–Ω–∏–µ:</span>
                <div id="task">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>

            <div class="input-group">
                <input 
                    type="text" 
                    id="userAnswer" 
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ..."
                    autocomplete="off"
                    maxlength="6"
                />
                <button id="checkBtn">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="result-container">
                <div id="result" class="result" aria-live="polite">
                    –ñ–¥—É –≤–∞—à –æ—Ç–≤–µ—Ç...
                </div>
            </div>
        </div>

        <div class="rules-section">
            <div class="rules-header" id="rulesToggle">
                üìö –ü—Ä–∞–≤–∏–ª–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
                <span>‚ñº</span>
            </div>
            <div class="rules-content" id="rulesContent">
                <ul>
                    <li>
                        <strong>–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ –¥–µ—Å—è—Ç–∫–æ–≤:</strong>
                        <br>–°–º–æ—Ç—Ä–∏–º –Ω–∞ —Ü–∏—Ñ—Ä—É <strong>–µ–¥–∏–Ω–∏—Ü</strong>.
                        <div class="example">
                            ‚Ä¢ –ï—Å–ª–∏ —Ü–∏—Ñ—Ä–∞ –µ–¥–∏–Ω–∏—Ü 0-4 ‚Üí –¥–µ—Å—è—Ç–∫–∏ –Ω–µ –º–µ–Ω—è–µ–º<br>
                            ‚Ä¢ –ï—Å–ª–∏ —Ü–∏—Ñ—Ä–∞ –µ–¥–∏–Ω–∏—Ü 5-9 ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–µ—Å—è—Ç–∫–∏ –Ω–∞ 1<br>
                            –ü—Ä–∏–º–µ—Ä—ã: 47 ‚Üí 50, 43 ‚Üí 40, 125 ‚Üí 130
                        </div>
                    </li>
                    <li>
                        <strong>–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ —Å–æ—Ç–µ–Ω:</strong>
                        <br>–°–º–æ—Ç—Ä–∏–º –Ω–∞ —Ü–∏—Ñ—Ä—É <strong>–¥–µ—Å—è—Ç–∫–æ–≤</strong>.
                        <div class="example">
                            ‚Ä¢ –ï—Å–ª–∏ —Ü–∏—Ñ—Ä–∞ –¥–µ—Å—è—Ç–∫–æ–≤ 0-4 ‚Üí —Å–æ—Ç–Ω–∏ –Ω–µ –º–µ–Ω—è–µ–º<br>
                            ‚Ä¢ –ï—Å–ª–∏ —Ü–∏—Ñ—Ä–∞ –¥–µ—Å—è—Ç–∫–æ–≤ 5-9 ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–æ—Ç–Ω–∏ –Ω–∞ 1<br>
                            –ü—Ä–∏–º–µ—Ä—ã: 478 ‚Üí 500, 432 ‚Üí 400, 1549 ‚Üí 1500
                        </div>
                    </li>
                    <li>
                        <strong>–í–∞–∂–Ω–æ:</strong> –ø—Ä–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–∏ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Ü–∏—Ñ—Ä—ã, —Å—Ç–æ—è—â–∏–µ –ø—Ä–∞–≤–µ–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑—Ä—è–¥–∞, –∏ –∑–∞–º–µ–Ω—è–µ–º –∏—Ö –Ω—É–ª—è–º–∏.
                    </li>
                </ul>
            </div>
        </div>

        <div class="footer">
            <p>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä –ø–æ—è–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã.</p>
            <p>–¢—Ä–µ–Ω–∞–∂—ë—Ä –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –û–ì–≠ ‚Ä¢ mathexam.space</p>
        </div>
    </div>

    <script>
        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
        let currentExample = {};
        let totalAttempts = 0;
        let correctAttempts = 0;
        let isButtonLocked = false;
        let currentLevel = 1; // 1: –¥–µ—Å—è—Ç–∫–∏, 2: —Å–æ—Ç–Ω–∏, 3: —Å–ª—É—á–∞–π–Ω—ã–π
        let progressTimeout = null;

        // --- –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ---

        function generateExample() {
            clearTimeout(progressTimeout);
            document.getElementById('progressFill').style.width = '0%';
            
            let roundTo;
            let number;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è
            if (currentLevel === 1) {
                roundTo = 10;
                number = Math.floor(Math.random() * (994 - 15 + 1)) + 15;
            } else if (currentLevel === 2) {
                roundTo = 100;
                number = Math.floor(Math.random() * (9499 - 150 + 1)) + 150;
            } else { // —Å–ª—É—á–∞–π–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
                roundTo = Math.random() < 0.5 ? 10 : 100;
                if (roundTo === 10) {
                    number = Math.floor(Math.random() * (994 - 15 + 1)) + 15;
                } else {
                    number = Math.floor(Math.random() * (9499 - 150 + 1)) + 150;
                }
            }

            const correctAnswer = Math.round(number / roundTo) * roundTo;
            
            currentExample = {
                number: number,
                roundTo: roundTo,
                correctAnswer: correctAnswer
            };

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è
            const roundText = roundTo === 10 ? '–¥–µ—Å—è—Ç–∫–æ–≤' : '—Å–æ—Ç–µ–Ω';
            document.getElementById('task').textContent = `–û–∫—Ä—É–≥–ª–∏—Ç–µ —á–∏—Å–ª–æ ${number} –¥–æ ${roundText}.`;
            document.getElementById('task').className = 'pulse';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = '–ñ–¥—É –≤–∞—à –æ—Ç–≤–µ—Ç...';
            resultDiv.className = 'result';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            const userInput = document.getElementById('userAnswer');
            userInput.value = '';
            userInput.disabled = false;
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            const checkBtn = document.getElementById('checkBtn');
            checkBtn.disabled = false;
            checkBtn.textContent = '‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å';
            isButtonLocked = false;
            
            // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            userInput.focus();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            startProgressBar();
        }

        function startProgressBar() {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = '0%';
            
            let width = 0;
            const interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                    if (!isButtonLocked) {
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫ –Ω–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
                        autoCheckAsIncorrect();
                    }
                } else {
                    width++;
                    progressFill.style.width = width + '%';
                }
            }, 100); // 100ms * 100 = 10 —Å–µ–∫—É–Ω–¥ –Ω–∞ –æ—Ç–≤–µ—Ç
        }

        function autoCheckAsIncorrect() {
            if (isButtonLocked) return;
            
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = `–í—Ä–µ–º—è –≤—ã—à–ª–æ! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${currentExample.correctAnswer}`;
            resultDiv.className = 'result incorrect';
            
            totalAttempts++;
            updateStats();
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤–≤–æ–¥
            isButtonLocked = true;
            document.getElementById('userAnswer').disabled = true;
            document.getElementById('checkBtn').disabled = true;
            document.getElementById('checkBtn').textContent = '‚è≥ –ñ–¥–∏—Ç–µ...';
            
            // –ù–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            progressTimeout = setTimeout(generateExample, 2000);
        }

        function validateInput(inputValue) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
            if (!inputValue.trim()) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –≤ –ø–æ–ª–µ –≤—ã—à–µ!', 'warning');
                return false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º)
            const regex = /^-?\d+$/;
            if (!regex.test(inputValue)) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ. –î—Ä–æ–±–Ω—ã–µ —á–∏—Å–ª–∞ –∏ —Å–∏–º–≤–æ–ª—ã –Ω–µ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è.', 'warning');
                return false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–∑—É–º–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω (–Ω–µ –±–æ–ª–µ–µ 6 —Ü–∏—Ñ—Ä)
            const num = parseInt(inputValue, 10);
            if (Math.abs(num) > 999999) {
                showNotification('–ß–∏—Å–ª–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ! –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –ø–æ–º–µ–Ω—å—à–µ.', 'warning');
                return false;
            }
            
            return true;
        }

        function checkAnswer() {
            if (isButtonLocked) return;
            
            const userInput = document.getElementById('userAnswer');
            const resultDiv = document.getElementById('result');
            const checkBtn = document.getElementById('checkBtn');
            
            const userAnswer = userInput.value.trim();
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
            if (!validateInput(userAnswer)) {
                return;
            }
            
            // –°—Ç—Ä–æ–≥–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª
            const isCorrect = parseInt(userAnswer, 10) === currentExample.correctAnswer;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            totalAttempts++;
            if (isCorrect) correctAttempts++;
            updateStats();
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            if (isCorrect) {
                resultDiv.textContent = `‚úÖ –í–µ—Ä–Ω–æ! ${currentExample.number} –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è –¥–æ ${currentExample.correctAnswer}.`;
                resultDiv.className = 'result correct';
                checkBtn.textContent = 'üéâ –û—Ç–ª–∏—á–Ω–æ!';
                createConfetti();
            } else {
                resultDiv.innerHTML = `
                    ‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: <strong>${currentExample.correctAnswer}</strong>.
                    <div class="rule-hint">
                        ${getRuleHint()}
                    </div>
                `;
                resultDiv.className = 'result incorrect';
                checkBtn.textContent = 'üòì –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë';
            }
            
            // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–∞ 2 —Å–µ–∫—É–Ω–¥—ã
            isButtonLocked = true;
            checkBtn.disabled = true;
            userInput.disabled = true;
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø—Ä–∏–º–µ—Ä—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            clearTimeout(progressTimeout);
            progressTimeout = setTimeout(generateExample, 2000);
        }

        function getRuleHint() {
            if (currentExample.roundTo === 10) {
                const ones = currentExample.number % 10;
                return `–°–º–æ—Ç—Ä–∏–º –Ω–∞ –µ–¥–∏–Ω–∏—Ü—ã: —Ü–∏—Ñ—Ä–∞ ${ones}. ${ones >= 5 ? '5 –∏ –±–æ–ª—å—à–µ ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–µ—Å—è—Ç–∫–∏' : '–ú–µ–Ω—å—à–µ 5 ‚Üí –¥–µ—Å—è—Ç–∫–∏ –Ω–µ –º–µ–Ω—è–µ–º'}.`;
            } else {
                const tens = Math.floor((currentExample.number % 100) / 10);
                return `–°–º–æ—Ç—Ä–∏–º –Ω–∞ –¥–µ—Å—è—Ç–∫–∏: —Ü–∏—Ñ—Ä–∞ ${tens}. ${tens >= 5 ? '5 –∏ –±–æ–ª—å—à–µ ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–æ—Ç–Ω–∏' : '–ú–µ–Ω—å—à–µ 5 ‚Üí —Å–æ—Ç–Ω–∏ –Ω–µ –º–µ–Ω—è–µ–º'}.`;
            }
        }

        function updateStats() {
            const statsElement = document.getElementById('statsCounter');
            const accuracy = totalAttempts > 0 ? Math.round((correctAttempts / totalAttempts) * 100) : 0;
            statsElement.textContent = `–†–µ—à–µ–Ω–æ: ${totalAttempts} | –í–µ—Ä–Ω–æ: ${correctAttempts} (${accuracy}%)`;
            saveStats();
        }

        function saveStats() {
            const statsToSave = {
                total: totalAttempts,
                correct: correctAttempts,
                level: currentLevel,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('roundingStats', JSON.stringify(statsToSave));
        }

        function loadStats() {
            const savedStats = JSON.parse(localStorage.getItem('roundingStats')) || { total: 0, correct: 0, level: 1 };
            totalAttempts = savedStats.total || 0;
            correctAttempts = savedStats.correct || 0;
            currentLevel = savedStats.level || 1;
            updateStats();
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.dataset.level) === currentLevel) {
                    btn.classList.add('active');
                }
            });
        }

        function createConfetti() {
            const container = document.querySelector('.container');
            const colors = ['#7aa7ff', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444'];
            
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-20px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = confetti.style.width;
                
                container.appendChild(confetti);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è
                const animation = confetti.animate([
                    { transform: `translateY(0) rotate(0deg)`, opacity: 1 },
                    { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                ], {
                    duration: Math.random() * 2000 + 1000,
                    easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                });
                
                animation.onfinish = () => confetti.remove();
            }
        }

        function showNotification(message, type = 'info') {
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'warning' ? 'var(--warning)' : 'var(--accent)'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                z-index: 1000;
                font-weight: 600;
                box-shadow: var(--shadow);
                animation: slideIn 0.3s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´ ---
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            loadStats();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π –ø—Ä–∏–º–µ—Ä
            generateExample();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('checkBtn').addEventListener('click', checkAnswer);
            document.getElementById('resetStats').addEventListener('click', resetStats);
            document.getElementById('rulesToggle').addEventListener('click', toggleRules);
            document.getElementById('userAnswer').addEventListener('keypress', handleKeyPress);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É—Ä–æ–≤–Ω–µ–π
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const level = parseInt(this.dataset.level);
                    setLevel(level);
                });
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        });

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                checkAnswer();
            }
        }

        function resetStats() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                totalAttempts = 0;
                correctAttempts = 0;
                currentLevel = 1;
                updateStats();
                showNotification('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞!', 'info');
                
                // –°–±—Ä–æ—Å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
                document.querySelectorAll('.level-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (parseInt(btn.dataset.level) === 1) {
                        btn.classList.add('active');
                    }
                });
                
                generateExample();
            }
        }

        function toggleRules() {
            const content = document.getElementById('rulesContent');
            const toggle = document.getElementById('rulesToggle');
            
            content.classList.toggle('show');
            toggle.querySelector('span').textContent = 
                content.classList.contains('show') ? '‚ñ≤' : '‚ñº';
        }

        function setLevel(level) {
            currentLevel = level;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.toggle('active', parseInt(btn.dataset.level) === level);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —É—Ä–æ–≤–µ–Ω—å
            saveStats();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä
            generateExample();
            
            showNotification(`–£—Ä–æ–≤–µ–Ω—å ${level} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!`, 'info');
        }
    </script>
</body>
</html>
